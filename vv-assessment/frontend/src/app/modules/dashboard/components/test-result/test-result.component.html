<div style="margin: 4%; min-height: 100vh; max-height: fit-content">
    <div class="center">
        <div style="display: flex; justify-content: space-between;align-items: center;">
            <h3 style="margin:1%">Upload file here</h3>
            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu">
                <mat-icon>more_vert</mat-icon>
            </button>
        </div>
        <mat-menu #menu="matMenu">
            <button mat-menu-item>
                <span (click)="logout()">Logout</span>
            </button>
        </mat-menu>
        <ngx-file-drop dropZoneLabel="Drop files here" (onFileDrop)="dropped($event)" (onFileOver)="fileOver($event)"
            (onFileLeave)="fileLeave($event)">
            <ng-template ngx-file-drop-content-tmp let-openFileSelector="openFileSelector">
                <button style="margin-left: 5px;" mat-raised-button color="primary" (click)="openFileSelector()">Browse
                    Files</button>
            </ng-template>
        </ngx-file-drop>
        <div class="upload-table">
            <table style="margin: 5px; padding-bottom: 5px;" class="table">
                <tbody class="upload-name-style">
                    <tr *ngFor="let item of files; let i=index">
                        <thead>
                            <tr>
                                <th>Name</th>
                            </tr>
                        </thead>
                        <td><strong>{{ item.relativePath }}</strong></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <div style="display: flex; justify-content: space-between;align-items: center;">
        <mat-form-field appearance="outline">
            <mat-label>Filter</mat-label>
            <input matInput [formControl]="filterControl" placeholder="Apply Filter">
        </mat-form-field>
        <div>
            <button color="primary" mat-raised-button (click)="getTopCandidates()" style="margin-right: 5px;">Top
                Candidates</button>
            <button color="primary" mat-raised-button [routerLink]="'/dashboard/questions'">Edit Questions</button>
        </div>
    </div>

    <table mat-table [dataSource]="dataSource" multiTemplateDataRows class="mat-elevation-z8">

        <!-- Table columns -->
        <ng-container *ngFor="let column of columnsToDisplay; let i = index" [matColumnDef]="column">
            <th mat-header-cell *matHeaderCellDef> {{column}} </th>
            <td mat-cell *matCellDef="let element"> {{element[column]}} </td>
        </ng-container>

        <!-- Expand column -->
        <ng-container matColumnDef="expand">
            <th mat-header-cell *matHeaderCellDef aria-label="row actions">&nbsp;</th>
            <td mat-cell *matCellDef="let element">
                <button mat-icon-button aria-label="expand row" (click)="toggleRow(element); $event.stopPropagation()">
                    <mat-icon>{{ expandedElement === element ? 'keyboard_arrow_up' : 'keyboard_arrow_down'
                        }}</mat-icon>
                </button>
                <button mat-icon-button aria-label="expand row"
                    (click)="openEditDialog(element); $event.stopPropagation()">
                    <mat-icon style="font-size: 20px;">edit</mat-icon>
                </button>
                <button mat-icon-button aria-label="expand row"
                    (click)="deleteCandiate(element); $event.stopPropagation()">
                    <mat-icon style="font-size: 20px;">delete</mat-icon>
                </button>
            </td>
        </ng-container>

        <!-- Expanded content column -->
        <ng-container matColumnDef="expandedDetail">
            <td mat-cell *matCellDef="let element" [attr.colspan]="columnsToDisplayWithExpand.length">
                <div class="example-element-detail"
                    [@detailExpand]="element == expandedElement ? 'expanded' : 'collapsed'">
                    <div class="exam-container">
                        <h2 style="text-align: end;">Total Correct Answers: {{ calculateTotalCorrectAnswers() }} /
                            30
                        </h2>
                        <div *ngFor="let category of userAnswers" class="category">
                            <mat-card style="background-color: #f9f9f9;">
                                <h2 style="text-align: center; padding: 1%;">{{ category.category }}</h2>
                                <div *ngFor="let question of category.value" class="question">
                                    <p>{{ question.question }}</p>
                                    <ul class="options">
                                        <li [ngClass]="{
                                      'correct': question.userAnswer === question.answer && question.answer === 'A',
                                      'incorrect': question.userAnswer !== question.answer && question.userAnswer === 'A',
                                      'selected': question.userAnswer === 'A'
                                    }">A. {{ question.a }}</li>
                                        <li [ngClass]="{
                                      'correct': question.userAnswer === question.answer && question.answer === 'B',
                                      'incorrect': question.userAnswer !== question.answer && question.userAnswer === 'B',
                                      'selected': question.userAnswer === 'B'
                                    }">B. {{ question.b }}</li>
                                        <li [ngClass]="{
                                      'correct': question.userAnswer === question.answer && question.answer === 'C',
                                      'incorrect': question.userAnswer !== question.answer && question.userAnswer === 'C',
                                      'selected': question.userAnswer === 'C'
                                    }">C. {{ question.c }}</li>
                                        <li [ngClass]="{
                                      'correct': question.userAnswer === question.answer && question.answer === 'D',
                                      'incorrect': question.userAnswer !== question.answer && question.userAnswer === 'D',
                                      'selected': question.userAnswer === 'D'
                                    }">D. {{ question.d }}</li>
                                    </ul>
                                    <p>Correct Option :- {{question.answer.toUpperCase()}}</p>
                                </div>
                            </mat-card>
                        </div>
                    </div>

                </div>
            </td>
        </ng-container>

        <!-- Header row -->
        <tr mat-header-row *matHeaderRowDef="columnsToDisplay"></tr>

        <!-- Row with expand button -->
        <tr mat-row *matRowDef="let element; columns: columnsToDisplayWithExpand;" class="example-element-row"
            [class.example-expanded-row]="expandedElement === element" (click)="toggleRow(element)">
        </tr>

        <!-- Expanded row -->
        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="example-detail-row"></tr>

    </table>

    <!-- Pagination -->
    <mat-paginator class="mt-3" [pageSize]="pageSize" [pageSizeOptions]="pageSizeOptions" [length]="totalPages"
        (page)="pageChanged($event)">
    </mat-paginator>
</div>