<table
  @stagger
  *ngIf="quotes"
  [dataSource]="quotes"
  matSortActive="{{ sortKey }}"
  matSortDirection="{{ sortDirection }}"
  matSortDisableClear
  matSort
  (matSortChange)="sortData($event)"
  class="w-full"
  mat-table
>
  <ng-container matColumnDef="id">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Deal #</th>
    <td *matCellDef="let item" mat-cell>{{ item.request_id }}</td>
  </ng-container>
  <ng-container matColumnDef="stock_no">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Stock #</th>
    <td *matCellDef="let item" mat-cell>{{ item.stock_no }}</td>
  </ng-container>
  <ng-container matColumnDef="first_name">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>First Name</th>
    <td *matCellDef="let item" mat-cell>{{ item.first_name }}</td>
  </ng-container>
  <ng-container matColumnDef="last_name">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Last Name</th>
    <td *matCellDef="let item" mat-cell>{{ item.last_name }}</td>
  </ng-container>
  <ng-container matColumnDef="year">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Year</th>
    <td *matCellDef="let item" mat-cell>{{ item.year }}</td>
  </ng-container>
  <ng-container matColumnDef="make">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Make</th>
    <td *matCellDef="let item" mat-cell>{{ item.make }}</td>
  </ng-container>
  <ng-container matColumnDef="model">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Model</th>
    <td *matCellDef="let item" mat-cell>{{ item.model }}</td>
  </ng-container>
  <ng-container matColumnDef="drive_off">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Drive Off</th>
    <td *matCellDef="let item" mat-cell>
      {{ item.drive_off ? '$ ' : '' }}{{ item.drive_off | number }}
    </td>
  </ng-container>
  <ng-container matColumnDef="mark_as_final">
		<th *matHeaderCellDef mat-header-cell mat-sort-header>Final</th>
		<td *matCellDef="let item" mat-cell>
			<mat-icon *ngIf="item.mark_as_final == 1">done</mat-icon>
		</td>
	</ng-container>
  <ng-container matColumnDef="created_at">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Created At</th>
    <td *matCellDef="let item" mat-cell>
      {{ item.created_at | date: 'MM/dd/yyy h:mm a' }}
    </td>
  </ng-container>
  <ng-container matColumnDef="updated_at">
    <th *matHeaderCellDef mat-header-cell mat-sort-header>Created At</th>
    <td *matCellDef="let item" mat-cell>
      {{ item.updated_at | date: 'MM/dd/yyy h:mm a' }}
    </td>
  </ng-container>
  <ng-container matColumnDef="actions">
    <th *matHeaderCellDef mat-header-cell></th>
    <td
      *matCellDef="let row; let i = index"
      class="w-10 text-secondary"
      mat-cell
    >
      <button
        (click)="$event.stopPropagation(); getSelectedRecord(row, i)"
        [matMenuTriggerData]="{ customer: row }"
        [matMenuTriggerFor]="actionsMenu"
        mat-icon-button
        type="button"
      >
        <mat-icon svgIcon="mat:more_horiz"></mat-icon>
      </button>
    </td>
  </ng-container>

  <tr *matHeaderRowDef="getDisplayedColumns(); sticky: true" mat-header-row></tr>
  <tr
    *matRowDef="let row; columns: getDisplayedColumns();"
    routerLink="./{{ row.id }}/edit"
    @fadeInUp
    class="hover:bg-hover trans-ease-out cursor-pointer"
    mat-row
  ></tr>
</table>

<div class="text-center mt-2" *ngIf="(didFetch$ | async) && quotes.length === 0">
  There are no quotes available. Please enter in a quotes to view them here
</div>

<mat-menu #actionsMenu="matMenu" xPosition="before" yPosition="below">
  <ng-template let-customer="customer" matMenuContent>
    <button mat-menu-item routerLink="./{{ selectedRecordDetail?.id }}/edit">
      <mat-icon svgIcon="mat:edit"></mat-icon>
      <span>Edit</span>
    </button>
    <button mat-menu-item (click)="onDelete(selectedRecordDetail, index)" *ngxPermissionsExcept="['concierge']">
      <mat-icon svgIcon="mat:delete"></mat-icon>
      <span>Delete</span>
    </button>
  </ng-template>
</mat-menu>
