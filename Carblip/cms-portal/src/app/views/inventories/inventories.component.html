<vex-page-layout>
	<vex-page-layout-header class="pb-16 flex flex-col items-start justify-center">
		<div class="w-full flex flex-col sm:flex-row justify-between">
			<div>
				<h1 class="title mt-0 mb-1">Inventories</h1>
				<vex-breadcrumbs [crumbs]="['Inventory']"></vex-breadcrumbs>
			</div>
		</div>
	</vex-page-layout-header>

	<vex-page-layout-content class="-mt-6">

		<div class="card -mt-16">
			<div class="head bg-app-bar px-6 h-16 border-b sticky left-0 flex items-center">
				<h2 class="title my-0 ltr:pr-4 rtl:pl-4 ltr:mr-4 rtl:ml-4 ltr:border-r rtl:border-l hidden sm:block flex-none">
					<span>Inventories</span>
				</h2>

				<div class="bg-foreground rounded-full border px-4 max-w-[300px] flex-auto flex items-center border border-gray-300">
					<mat-icon class="icon-sm text-secondary search-icon" svgIcon="mat:search"></mat-icon>
					<input [(ngModel)]="search"
						class="px-4 py-2 border-0 outline-none w-full bg-transparent"
						placeholder="Search..."
						name="searchSource"
						type="search"
						#searchInput
						(ngModelChange)="onClearSearch($event)">
				</div>


				<span class="flex-1"></span>

				<button 
				(click)="showFilterOptions = !showFilterOptions"
				class="ml-4 flex-none"
				color="primary"
				matTooltip="Filters"
				type="button">
				<mat-icon svgIcon="mat:filter_list"></mat-icon>
				</button>

					<button (click)="onResetFilter()"
						*ngIf="isResetAvailable()"
					class="ml-4 flex-none"
					color="warn"
					mat-mini-fab
					matTooltip="Clear Filters"
					type="button">
					<mat-icon svgIcon="mat:clear"></mat-icon>
				</button>
				
				<button
					[matMenuTriggerFor]="columnFilterMenu"
					mat-icon-button
					class="ml-4 flex-none"
					color="primary"
					matTooltip="Column Filters"
					type="button">
					<mat-icon svgIcon="mat:settings"></mat-icon>
				</button>

				<button (click)="onRefresh()"
					*ngIf="showRefreshButton()"
					class="ml-4 flex-none"
					color="primary"
					mat-mini-fab
					matTooltip="Refresh Data"
					type="button">
					<mat-icon svgIcon="mat:refresh"></mat-icon>
				</button>

			</div>
				<div class="head bg-app-bar px-6 pt-7 h-16 sticky left-0 flex items-center" @fadeInUp *ngIf="showFilterOptions">
					<form [formGroup]="filterForm" class="w-full">
						<div class="grid grid-cols-1 sm:grid-cols-5 gap-4">
							<div class="flex items-center">
							<mat-form-field class="filter">
								<mat-label>Dealer</mat-label>
								<mat-select [formControl]="filterForm.controls['dealer']" #dealerSelect (selectionChange)="applyFilter($event)">
								<mat-option>
									<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="dealerFilterCtrl" [preventHomeEndKeyPropagation]="true">
										<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
									</ngx-mat-select-search>
									</mat-option>
									<mat-option *ngFor="let item of filteredDealers" [value]="item.id">
										{{item.name}}
									</mat-option>
								</mat-select>
							</mat-form-field>
							</div>
							<div class="flex items-center">
								<mat-form-field class="filter">
									<mat-label>Year</mat-label>
									<mat-select [formControl]="filterForm.controls['year']" #yearSelect (selectionChange)="applyFilter($event)">
									<mat-option>
										<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="yearFilterCtrl" [preventHomeEndKeyPropagation]="true">
											<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
										</ngx-mat-select-search>
										</mat-option>
										<mat-option *ngFor="let item of filteredYears" [value]="item.id">
											{{item.name}}
										</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
							<div class="flex items-center">
								<mat-form-field class="filter">
									<mat-label>Make</mat-label>
									<mat-select [formControl]="filterForm.controls['make']" #makeSelect (selectionChange)="onMakeFilterChange($event.value);applyFilter($event);">
									<mat-option>
										<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="makeFilterCtrl" [preventHomeEndKeyPropagation]="true">
											<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
										</ngx-mat-select-search>
										</mat-option>
											<mat-option *ngFor="let item of filteredMakes" [value]="item.id">
												{{item.name}}
											</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
							<div class="flex items-center">
								<mat-form-field class="filter">
									<mat-label>Model</mat-label>
									<mat-select [formControl]="filterForm.controls['model']" #modelSelect (selectionChange)="onModelFilterChange($event.value);applyFilter($event)">
									<mat-option>
										<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="modelFilterCtrl" [preventHomeEndKeyPropagation]="true">
											<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
										</ngx-mat-select-search>
										</mat-option>
											<mat-option *ngFor="let item of filteredModels" [value]="item.id">
												{{item.name}}
											</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
							<div class="flex items-center">
								<mat-form-field class="filter">
									<mat-label>Trim</mat-label>
									<mat-select [formControl]="filterForm.controls['trim']" #trimSelect (selectionChange)="applyFilter($event)">
									<mat-option>
										<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="trimFilterCtrl" [preventHomeEndKeyPropagation]="true">
											<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
										</ngx-mat-select-search>
										</mat-option>
											<mat-option *ngFor="let item of filteredTrims" [value]="item.id">
												{{item.desc}}
											</mat-option>
									</mat-select>
								</mat-form-field>
							</div>
						</div>
					</form>
				</div>
					<mat-progress-bar *ngIf="(fetching$ | async)" mode="indeterminate"></mat-progress-bar>
					<div class="overflow-auto h-full-vh sticky">
					<app-inventories-table class="display-block w-100 list-table" *ngIf="isColumnAvailable" [columnHeaders]="columnHeaders"></app-inventories-table>
					</div>
					<mat-paginator
						#paginator
						[length]="tablePagination.length"
						[pageSize]="tablePagination.pageSize"
						[pageIndex]="tablePagination.pageIndex"
						[pageSizeOptions]="[20, 50, 100]"
						[showFirstLastButtons]="true"
						(page)="onPaginateChange($event)"
					>
					</mat-paginator>

					<!-- Column Filters -->
					<mat-menu #columnFilterMenu="matMenu" xPosition="before" yPosition="below">
						<button (click)="toggleColumnVisibility(column, $event);$event.stopPropagation()" *ngFor="let column of columnHeaders"
								class="checkbox-item mat-menu-item">
						<mat-checkbox (click)="$event.stopPropagation()" (change)="toggleColumnVisibility(column, $event)" [checked]="column.visible" color="primary">
							{{ column.label }}
						</mat-checkbox>
						</button>
					</mat-menu>
				</div>
				</vex-page-layout-content>
</vex-page-layout>
