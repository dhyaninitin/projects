<form [formGroup]="itemForm" (ngSubmit)="submit()" autocomplete="new-userform">
	<div class="flex items-center" mat-dialog-title>
		<h2 class="headline m-0 flex-auto">{{data.title}}</h2>
		<button class="text-secondary" mat-dialog-close mat-icon-button type="button">
			<mat-icon svgIcon="mat:close"></mat-icon>
		</button>
	</div>

	<mat-divider class="-mx-6 text-border"></mat-divider>
	<mat-dialog-content class="flex flex-col">
	<div class="flex flex-col sm:flex-row">

		<mat-form-field class="mt-3 flex-auto">
			<mat-label>Year</mat-label>
			<mat-select [formControl]="itemForm.controls['year']" #yearSelect (selectionChange)="onYearFilterChange($event.value)">
			<mat-option>
				<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="yearFilterCtrl" [preventHomeEndKeyPropagation]="true">
					<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
				</ngx-mat-select-search>
			</mat-option>
				<mat-option value="-1" *ngIf="userType == 1 || userType == 2">N/A</mat-option>
				<mat-option *ngFor="let item of filteredYears" [value]="item.id">
					{{item.name}}
				</mat-option>
			</mat-select>
		</mat-form-field>

		<mat-form-field class="sm:mt-3 sm:ml-6 flex-auto">
			<mat-label>Make</mat-label>
			<mat-select [formControl]="itemForm.controls['make']" #makeSelect (selectionChange)="onMakeFilterChange($event.value)">
			<mat-option>
				<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="makeFilterCtrl" [preventHomeEndKeyPropagation]="true">
					<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
				</ngx-mat-select-search>
			</mat-option>
				<mat-option value="-1" *ngIf="userType == 1 || userType == 2">N/A</mat-option>
				<mat-option *ngFor="let item of filteredMakes" [value]="item.id">
					{{item.name}}
				</mat-option>
			</mat-select>
		</mat-form-field>
		</div>
		<div class="flex flex-col sm:flex-row">
			<mat-form-field class="flex-auto">
				<mat-label>Model</mat-label>
				<mat-select [formControl]="itemForm.controls['model']" #modelSelect (selectionChange)="onModelFilterChange($event.value)">
				<mat-option> 
					<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="modelFilterCtrl" [preventHomeEndKeyPropagation]="true">
						<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
					</ngx-mat-select-search>
				</mat-option>
					<mat-option value="-1" *ngIf="userType == 1 || userType == 2">N/A</mat-option>
					<mat-option *ngFor="let item of filteredModels" [value]="item.id">
						{{item.name}}
					</mat-option>
				</mat-select>
			</mat-form-field>

			<mat-form-field class="sm:ml-6 flex-auto">
				<mat-label>Trim</mat-label>
				<mat-select [formControl]="itemForm.controls['trim']" #trimSelect>
				<mat-option>
					<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="trimFilterCtrl" [preventHomeEndKeyPropagation]="true">
						<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
					</ngx-mat-select-search>
				</mat-option>
					<mat-option value="-1" *ngIf="userType == 1 || userType == 2">N/A</mat-option>
					<mat-option *ngFor="let item of filteredTrims" [value]="item.id">
						{{item.trim}}
					</mat-option>
				</mat-select>
			</mat-form-field>

		</div>

		<div class="flex flex-col sm:flex-row">
			<mat-form-field class="flex-auto">
				<mat-label>Hubspot Deal Stage</mat-label>
				<mat-select [formControl]="itemForm.controls['dealStage']" #dealStageSelect>
				<mat-option>
					<ngx-mat-select-search [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' " [formControl]="dealStageFilterCtrl" [preventHomeEndKeyPropagation]="true">
						<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
					</ngx-mat-select-search>
				</mat-option>
					<mat-option *ngFor="let item of filteredDealStages" [value]="item.stage_id">
						{{item.label}} ({{ item?.pipeline_name }})
					</mat-option>
				</mat-select>
			</mat-form-field>

			<mat-form-field class="sm:ml-6 flex-auto">
				<mat-label>Portal Deal Stage</mat-label>
				<mat-select [formControl]="itemForm.controls['portalDealStage']" placeholder="Portal Deal Stage" #singleSelect
					(selectionChange)="onPortalDealStageFilterChange($event.value)" (infiniteScroll)="getNextBatchOfPortalDealStages()" [threshold]="'0.5%'"
					[debounceTime]="150" [complete]="portalDealStagesOffset === totalPortalDealStagesPages" msInfiniteScroll>
					<mat-option>
						<ngx-mat-select-search *ngIf="true" [placeholderLabel]="'Search...'" [noEntriesFoundLabel]="'No matches' "
							[formControl]="portalDealStageFilterCtrl" [preventHomeEndKeyPropagation]="true">
							<mat-icon ngxMatSelectSearchClear>delete</mat-icon>
						</ngx-mat-select-search>
					</mat-option>
					<mat-option *ngFor="let item of filteredPortalDealStages" [value]="item.id">
						{{ item?.label }} ({{ item?.pipeline }})
					</mat-option>
					<mat-option *ngIf="loadingPortalDealStages">
						<mat-spinner class="input-mat-spinner-loader" color="primary" [diameter]="30"></mat-spinner>
					</mat-option>
				</mat-select>
			</mat-form-field>
		</div>
			<mat-dialog-actions align="end">
				<div>
				<button mat-button mat-dialog-close type="button" (click)="dialogRef.close(false)">Cancel</button>
				<app-button-loading loadingText="Processing..." [loading]="saving" [disabled]="itemForm.invalid || itemForm.pristine" color="primary">{{"CREATE" | translate }}</app-button-loading>
				<span fxFlex></span>
				</div>
			</mat-dialog-actions>
	</mat-dialog-content>
</form>
